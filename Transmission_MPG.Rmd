---
title: "Relationship between Transmission Type and Fuel Efficiency"
author: "F. Alex Crofut"
date: "Saturday, April 30, 2016"
output: html_document
---

##Executive Summary

* Is an automatic or manual transmission better for MPG
* Quantify the MPG difference between automatic and manual transmissions

##Assumptions
* Population is independent and identically distributed.
* Measurement error is accounted for by significant digits.
* A 95% confidence interval is sufficient to determine significance.

##Exploratory Data Analysis
###Required Packages
```{r packages, echo=FALSE}
if (!"lattice" %in% installed.packages()) install.packages("lattice")
library("lattice")
if (!"datasets" %in% installed.packages()) install.packages("datasets")
library("datasets")
if (!"ggplot2" %in% installed.packages()) install.packages("ggplot2")
library("ggplot2")
if (!"gridExtra" %in% installed.packages()) install.packages("gridExtra")
library("gridExtra")
if (!"caret" %in% installed.packages()) install.packages("caret")
library("caret")
```

* datasets
* ggplot2
* gridExtra
* caret
* lattice

##Data Structure and Processing
###Structure
```{r structure}
data(mtcars)
str(mtcars)
```
The dataset shows 32 observations of 11 variables.  The transmission type (am), a focus of the 
analysis, is denoted as either "0" (automatic) or "1" (manual).  In the processing section,
the numeric values of am are translated into factors "automatic" and "manual".

###Processing
```{r processing}
# replace 0&1 with "automatic" and "manual" in new dataframe
mtcars2 <- mtcars
mtcars2$am[mtcars2$am == 0] <- "automatic"
mtcars2$am[mtcars2$am == 1] <- "manual"
```

###Data Exploration
```{r exploration}
meanMPGAuto <- mean(subset(mtcars2, am== "automatic")$mpg)   #mean mpg of automatics
meanMPGManual <- mean(subset(mtcars2, am == "manual")$mpg)   #mean mpg of manuals
```
As apparent in the box plot "Miles per Gallon by Transmission Type" (Appendix - Figure 1), there is a significant difference between the fuel efficiency in miles per gallon (mpg) for automatic and manual transmissions.  Cars with manual transmissions have a mean mpg of `r round(meanMPGManual, 3)`, 
a full `r round(meanMPGManual - meanMPGAuto, 3)` improvement over automatics
(`r round(meanMPGAuto, 3)` mpg). 

##Models
In order to examine this relationship more closely, this analysis will apply a simple linear
regression.  If the linear model does not explain the regression variance as measured by the adjusted r-squared, the analysis will add additional variables to the model.  The models will be 
compared via nested model testing to determine the best fit.  That fit will be evaluated
using the following methods:

* Residuals Plot
* Q-Q
* Scale-Location
* Leverage

####Simple Linear Regression
The first model utilized is a simple linear regression looking at the relationship between
fuel efficiency and transmission type.
```{r slr}
fitS <- lm(mpg ~ am, mtcars2)
```

The confidence interval of [`r round(confint(fitS, "ammanual"), 3)`] does not include zero and the p-value of `r format(round(summary(fitS)$coefficients[2, 4], 6), scientific=FALSE)` indicate the null hypothesis (transmission type is not related to fuel efficiency) can be rejected with a 95% confidence interval.  However, based on the adjusted R-squared, only `r round(summary(fitS)$adj.r.squared * 100, 1)`% of the variance is explained by our model.

####Multivariable Regression Model
Due to the low percentage of variance explained by the simple linear model, additional variables will be added to the model.  The variables were chosen utilizing a feature plot (Appendix - Figure 2 ) to identify weight ("wt") as being correlated to fuel efficiency.  Variables correlated with weight were eliminated and quarter-mile times ("qsec") was retained because it was not correlated with weight.
```{r mvrm}
fitM <- lm(mpg ~ am + wt + qsec, mtcars2)
summary(fitM)
```



####Nested Model Testing
```{r nestedmodel}
fit2 <- update(fitS, mpg ~ am + wt)
fit3 <- update(fitS, mpg ~ .)
anova(fitS, fit2, fitM, fit3)
```
###Residual Plot and Diagnostics



###Quantify Uncertainty



##Conclusions


#Appendix
Figure 1:
```{r fig1}
ggplot(aes(x = am, y = mpg), data = mtcars2) +
  geom_boxplot(fill = "blue") +
  labs(x = "Transmission Type", y = "Miles per Gallon") + 
  ggtitle("Miles per Gallon by Transmission Type") + 
  annotate(geom = "text", x = 1, y = meanMPGAuto, 
           color="white", label = "-----", size=7, fontface="bold", 
           angle = 0) + 
  annotate(geom = "text", x = 2, y = meanMPGManual, 
           color="white", label = "-----", size=7, fontface="bold", 
           angle = 0)
```

Figure 2:
```{r fig2}
featurePlot(x = mtcars2[,c(1, 3, 4, 6, 7)], y = mtcars2$am, plot = "pairs", col = c("red", "blue"), 
            title = "Feature Plot for Variables in Analysis")
```

